
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedQuiz Engine</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --success: #27ae60; --danger: #c0392b; --light: #ecf0f1; }
        body { font-family: system-ui, -apple-system, sans-serif; background: #f4f7f6; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 250px; background: var(--primary); color: white; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar h2 { margin-top: 0; border-bottom: 1px solid #555; padding-bottom: 10px; }
        .subject-btn { background: none; border: none; color: #bdc3c7; text-align: left; padding: 12px; width: 100%; cursor: pointer; font-size: 1rem; border-radius: 5px; margin-bottom: 5px; }
        .subject-btn:hover, .subject-btn.active { background: var(--secondary); color: white; font-weight: bold; }
        .main { flex: 1; padding: 20px; overflow-y: auto; display: flex; justify-content: center; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 800px; height: fit-content; }
        .question-image { max-width: 100%; border-radius: 8px; margin: 15px 0; border: 1px solid #ddd; display: none; }
        .option-btn { padding: 12px 15px; border: 2px solid #e0e0e0; background: white; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: 0.2s; }
        .option-btn:hover { border-color: var(--secondary); background: #f9fbff; }
        .option-btn.selected { border-color: var(--secondary); background: #eaf2f8; font-weight: bold; }
        .option-btn.correct { border-color: var(--success); background: #d4edda; color: #155724; }
        .option-btn.wrong { border-color: var(--danger); background: #f8d7da; color: #721c24; }
        .explanation { margin-top: 20px; padding: 15px; background: var(--light); border-left: 5px solid var(--secondary); display: none; line-height: 1.6; }
        .footer { margin-top: 20px; display: flex; justify-content: space-between; }
        button.action { padding: 10px 25px; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem; background: var(--secondary); color: white; }
        button.action:disabled { background: #bdc3c7; cursor: not-allowed; }
        @media (max-width: 768px) { body { flex-direction: column; } .sidebar { width: 100%; height: 60px; flex-direction: row; overflow-x: auto; align-items: center; padding: 10px; } .sidebar h2 { display: none; } .subject-btn { width: auto; white-space: nowrap; margin-right: 10px; } }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <h2>ü©∫ Subjects</h2>
    </div>
    <div class="main">
        <div class="card">
            <h3 id="header">Select a Subject</h3>
            <img id="q-image" class="question-image">
            <p id="q-text" style="font-size: 1.2rem; font-weight: 600;">Select a subject from the sidebar to start.</p>
            <div id="options"></div>
            <div id="explanation" class="explanation"></div>
            <div class="footer">
                <button class="action" id="submit-btn" onclick="submitAnswer()" disabled>Submit</button>
                <button class="action" id="next-btn" onclick="nextQuestion()" style="display:none">Next ‚û°Ô∏è</button>
            </div>
        </div>
    </div>

<script>
    // DATA INJECTION POINT
    const subjects = ["Dermatology", "Biochemistry", "OBGYN", "Pathology", "Pharmacology", "Orthopaedics", "Anaesthesia", "Surgery", "Radiology", "Physiology", "Pediatrics", "Ophthalmology", "PSM", "FMT", "Microbiology", "Medicine", "Anatomy", "ENT", "Psychiatry"];
    
    let questions = [];
    let currentIdx = 0;
    let currentSubject = "";
    let selectedOption = null;

    const sidebar = document.getElementById('sidebar');
    
    subjects.forEach(sub => {
        const btn = document.createElement('button');
        btn.className = 'subject-btn';
        btn.innerText = sub.replace(/_/g, " ");
        btn.onclick = () => loadSubject(sub, btn);
        sidebar.appendChild(btn);
    });

    async function loadSubject(sub, btn) {
        document.querySelectorAll('.subject-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');
        currentSubject = sub;
        
        try {
            const res = await fetch(`${sub}/data.json`);
            if(!res.ok) throw new Error("Failed to load");
            questions = await res.json();
            currentIdx = 0;
            loadQuestion();
        } catch(e) { alert("Error loading data for " + sub); console.error(e); }
    }

    function loadQuestion() {
        if(currentIdx >= questions.length) {
            document.querySelector('.card').innerHTML = "<h2>üéâ Chapter Complete!</h2><button class='action' onclick='location.reload()'>Restart</button>";
            return;
        }
        const q = questions[currentIdx];
        document.getElementById('header').innerText = `${currentSubject.replace(/_/g, " ")} | Q${currentIdx+1}/${questions.length}`;
        document.getElementById('q-text').innerText = q.text;
        
        // Image Handling
        const imgEl = document.getElementById('q-image');
        imgEl.style.display = 'none';
        
        // Fallback heuristic for images
        const probableImg = `${currentSubject}/images/${currentSubject}_img_${q.id}.png`;
        
        // Try to load image
        if(q.image) {
             imgEl.src = `${currentSubject}/images/${q.image}`;
             imgEl.style.display = 'block';
        } else {
             // Try guessing based on ID
             imgEl.src = probableImg;
             imgEl.onload = function() { this.style.display = 'block'; };
             imgEl.onerror = function() { this.style.display = 'none'; };
        }

        const optsDiv = document.getElementById('options');
        optsDiv.innerHTML = "";
        selectedOption = null;
        
        Object.entries(q.options).forEach(([key, val]) => {
            const div = document.createElement('div');
            div.className = 'option-btn';
            div.innerText = `${key.toUpperCase()}) ${val}`;
            div.onclick = () => {
                if(document.getElementById('next-btn').style.display !== 'none') return;
                document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                div.classList.add('selected');
                selectedOption = key;
                document.getElementById('submit-btn').disabled = false;
            };
            optsDiv.appendChild(div);
        });

        document.getElementById('explanation').style.display = 'none';
        document.getElementById('submit-btn').style.display = 'inline-block';
        document.getElementById('submit-btn').disabled = true;
        document.getElementById('next-btn').style.display = 'none';
    }

    function submitAnswer() {
        const q = questions[currentIdx];
        const correct = (q.correct_option || "").trim().toLowerCase();
        const btns = document.querySelectorAll('.option-btn');
        
        btns.forEach(btn => {
            const k = btn.innerText.charAt(0).toLowerCase();
            if(k === correct) btn.classList.add('correct');
            if(btn.classList.contains('selected') && k !== correct) btn.classList.add('wrong');
        });

        const expDiv = document.getElementById('explanation');
        expDiv.innerHTML = `<b>Explanation:</b><br>${q.explanation || "No explanation."}`;
        
        if(q.explanation_image) {
            expDiv.innerHTML += `<br><br><img src='${currentSubject}/images/${q.explanation_image}' style='max-width:100%; border-radius:5px;'>`;
        }
        
        expDiv.style.display = 'block';

        document.getElementById('submit-btn').style.display = 'none';
        document.getElementById('next-btn').style.display = 'inline-block';
    }

    function nextQuestion() {
        currentIdx++;
        loadQuestion();
    }
</script>
</body>
</html>
